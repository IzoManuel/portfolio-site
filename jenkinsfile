pipeline {
  agent any

  stages {
    stage('Clone Repository') {
      steps {
        git url: 'git@github.com:IzoManuel/portfolio-site.git'
      }
    }

    stage('Echo Stage') {
      steps {
        echo 'Building the portfolio site...'
      }
    }

    stage('Deploy') {
      steps {
        sshagent(['deploy-ssh-key']) {
          sh """
            ssh -o StrictHostKeyChecking=no ubuntu@13.235.51.44 << EOF
              sudo chown -R ubuntu:ubuntu /var/www/html
              mkdir -p /var/www/html/portfolio-site
            EOF

            scp -o StrictHostKeyChecking=no -r ./* ubuntu@13.235.51.44:/var/www/html/portfolio-site

            ssh -o StrictHostKeyChecking=no ubuntu@13.235.51.44 << EOF
              bash /var/www/html/portfolio-site/deploy.sh
            EOF
          """
        }
      }
    }
  }
}
