pipeline {
  agent any

  stages {
    stage('Clone Repository') {
      steps {
        git url: 'git@github.com:IzoManuel/portfolio-site.git'
      }
    }

    stage('Echo Stage') {
      steps {
        echo 'Building the portfolio site...'
      }
    }

    stage('Deploy') {
      steps {
        sh """
          ssh -i ~/.ssh/key.pem -o StrictHostKeyChecking=no ubuntu@13.235.51.44 'sudo chown -R ubuntu:ubuntu /var/www/html'
          ssh -i ~/.ssh/key.pem -o StrictHostKeyChecking=no ubuntu@13.235.51.44 'mkdir -p /var/www/html/portfolio-site'
          scp -i ~/.ssh/key.pem -o StrictHostKeyChecking=no -r * ubuntu@13.235.51.44:/var/www/html/portfolio-site
          ssh -i ~/.ssh/key.pem -o StrictHostKeyChecking=no ubuntu@13.235.51.44 'bash /var/www/html/portfolio-site/deploy.sh'
        """
      }
    }
  }
}
